<!DOCTYPE html>
<html>

<head>
    <title>Restaurantes de Colombia</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .restaurant-card {
            margin: 10px;
            display: inline-block;
            width: 300px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 2px 2px 5px #888888;
        }

        .restaurant-card img {
            max-width: 100%;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .restaurant-details {
            padding: 10px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Restaurantes de Colombia</a>
        <span class="navbar-text ml-auto" id="loggedInUser" style="margin-right: 20px;">
            Usuario en Sesión: <span id="username"></span>
        </span>
        <a class="btn btn-danger" id="logoutButton" style="margin-right: 20px;">Cerrar Sesión</a>
    </nav>
    <div class="container mt-4">
        <h1>Lista de Restaurantes</h1>
        <div class="form-group">
            <label for="citySelect">Filtrar por ciudad:</label>
            <select class="form-control" id="citySelect">
                <option value="">Selecciona una ciudad</option>
                <option value="Bogotá">Bogotá</option>
                <option value="Medellín">Medellín</option>
                <option value="Cali">Cali</option>
                <option value="Cartagena">Cartagena</option>
                <!-- Agrega más opciones de ciudades aquí -->
            </select>
        </div>
        <div class="row" id="restaurantList">
        </div>
        <div id="noResultsMessage" class="alert alert-warning" style="display: none;">
            No se encontraron restaurantes en la ciudad seleccionada.
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Verificar si hay un token JWT en el almacenamiento local
        var jwtToken = localStorage.getItem('jwtToken');
        if (!jwtToken) {
            // Redirigir al usuario a la página de inicio de sesión si no está autenticado
            window.location.href = 'index.html';
        }

        // Función para cargar la lista de restaurantes desde la API
        function loadRestaurantList(city) {
            $.ajax({
                url: 'https://restaurantsapi-dev-narf.2.us-1.fl0.io/api/Restaurant' + (city ? '/byCiudad/' + city : ''),
                type: 'GET',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken
                },
                success: function (data) {
                    var restaurantList = $('#restaurantList');
                    var noResultsMessage = $('#noResultsMessage');
                    restaurantList.empty();
                    if (data.length > 0) {
                        // Mostrar los restaurantes encontrados en mosaico
                        noResultsMessage.hide();
                        data.forEach(function (restaurant) {
                            var restaurantCard = '<div class="restaurant-card">';
                            restaurantCard += '<img src="' + restaurant.imagenUrl + '">';
                            restaurantCard += '<div class="restaurant-details">';
                            restaurantCard += '<h5>' + restaurant.nombre + '</h5>';
                            restaurantCard += '<p>Ubicación: ' + restaurant.ubicacion + '</p>';
                            restaurantCard += '<p>Tipo de Cocina: ' + restaurant.tipoCocina + '</p>';
                            restaurantCard += '<p>Descripción: ' + restaurant.descripcion + '</p>';
                            restaurantCard += '<p>Likes: ' + restaurant.likes + '</p>';
                            restaurantCard += '</div></div>';
                            restaurantList.append(restaurantCard);
                        });
                    } else {
                        // Mostrar mensaje si no se encontraron resultados
                        noResultsMessage.show();
                    }
                },
                error: function () {
                    alert('Error al cargar la lista de restaurantes.');
                    let select = document.getElementById("citySelect");
                    select.value = "";  
                    loadRestaurantList();
                }
            });
        }

        // Llamar a la función para cargar la lista de restaurantes al cargar la página
        loadRestaurantList();

        // Manejar el cambio en el select de ciudad
        $('#citySelect').change(function () {
            var selectedCity = $(this).val();
            loadRestaurantList(selectedCity);
        })

        // Obtener el nombre de usuario del token JWT
        var jwtPayload = jwtToken.split('.')[1];
        var decodedJwt = atob(jwtPayload);
        var username = JSON.parse(decodedJwt).unique_name;
        $('#username').text(username);
    </script>
    <script>
        
        $('#logoutButton').click(function () {
            // Eliminar el token JWT del almacenamiento local del navegador
            localStorage.removeItem('jwtToken');
            // Redirigir al usuario a la página de inicio de sesión
            window.location.href = 'index.html';
        });
    
       
    </script>
</body>

</html>
